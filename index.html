<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script>
      let connectedDevice;
      let characteristic;

      //
      async function connectToDevice() {
        try {
          // Request the Bluetooth device
          const device = await navigator.bluetooth.requestDevice({
            filters: [{ services: ['your_service_uuid'] }]
          });

          // Connect to the GATT server of the device
          const server = await device.gatt.connect();

          // Get the primary service
          const service = await server.getPrimaryService('your_service_uuid');

          // Get the characteristic you want to read/write from/to
          characteristic = await service.getCharacteristic('your_characteristic_uuid');

          // Set up event listeners for characteristic value changes
          characteristic.addEventListener('characteristicvaluechanged', handleCharacteristicValueChanged);

          // Start notifications for the characteristic
          await characteristic.startNotifications();

          connectedDevice = device;
          console.log('Connected to device:', device.name);
        } catch (error) {
          console.error('Bluetooth error:', error);
        }
      }

      function handleCharacteristicValueChanged(event) {
        const value = event.target.value;
        // Do something with the received value
        console.log('Received value:', value);
      }

      function setup() {
        createCanvas(400, 400);
        
        // Create a button to connect to the Bluetooth device
        const connectButton = createButton('Connect to Bluetooth');
        connectButton.position(10, 10);
        connectButton.mousePressed(connectToDevice);
      }

      function draw() {
        background(220);
        // Your drawing logic here
      }

      // Example function to send data to the Bluetooth device
      function sendData(data) {
        if (connectedDevice && characteristic) {
          const dataArray = new Uint8Array([data]); // Assuming data is a single byte
          characteristic.writeValue(dataArray);
          console.log('Sent data:', data);
        }
      }
    </script>
  </head>
  <body>
  </body>
</html>
